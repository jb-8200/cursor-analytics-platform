# Feature Breakdown: Cursor Usage Analytics Platform

> **ðŸ“š REFERENCE DOCUMENT**
> This is a project-level feature overview for orientation purposes.
> **Source of truth**: `services/{service}/SPEC.md` for feature details, `.work-items/` for implementation status.

**Version**: 2.0.0
**Last Updated**: January 2026

This document provides a comprehensive breakdown of all features across the three services, organized by priority and implementation phase. Version 2.0 introduces seed-based generation, exact Cursor API matching, GitHub PR simulation, and research framework support.

## Feature Overview Matrix

### cursor-sim Features (v2.0)

| Feature ID | Feature Name | Priority | Complexity | Phase |
|------------|--------------|----------|------------|-------|
| SIM-R001 | Seed Loading & Validation | P0 | Medium | 1 |
| SIM-R002 | CLI Configuration v2 | P0 | Low | 1 |
| SIM-R003 | Commit Generation Engine | P0 | High | 1 |
| SIM-R004 | Cursor Admin API | P0 | Medium | 1 |
| SIM-R005 | Cursor AI Code Tracking API | P0 | Medium | 1 |
| SIM-R006 | Cursor Team Analytics API | P0 | High | 1 |
| SIM-R007 | Cursor By-User Analytics API | P0 | Medium | 1 |
| SIM-R008 | In-Memory Storage v2 | P0 | Medium | 1 |
| SIM-R009 | PR Generation Pipeline | P1 | High | 2 |
| SIM-R010 | Review Simulation | P1 | High | 2 |
| SIM-R011 | GitHub Repos/PRs API | P1 | High | 2 |
| SIM-R012 | Quality Outcomes | P1 | Medium | 2 |
| SIM-R013 | Research Dataset Export | P2 | Medium | 3 |
| SIM-R014 | Code Survival Tracking | P2 | High | 3 |
| SIM-R015 | Replay Mode | P2 | Medium | 3 |

### cursor-analytics-core Features (unchanged)

| Feature ID | Feature Name | Priority | Complexity | Phase |
|------------|--------------|----------|------------|-------|
| CORE-001 | Data Ingestion Worker | P0 | Medium | 1 |
| CORE-002 | Database Schema & Migrations | P0 | Medium | 1 |
| CORE-003 | GraphQL API Server | P0 | Medium | 1 |
| CORE-004 | Metric Calculations | P0 | High | 1 |
| CORE-005 | Developer Queries | P0 | Medium | 1 |
| CORE-006 | Team Aggregations | P1 | Medium | 2 |
| CORE-007 | Dashboard KPIs | P1 | Medium | 2 |
| CORE-008 | Time Range Filtering | P1 | Low | 2 |

### cursor-viz-spa Features (unchanged)

| Feature ID | Feature Name | Priority | Complexity | Phase |
|------------|--------------|----------|------------|-------|
| VIZ-001 | Dashboard Layout | P0 | Medium | 1 |
| VIZ-002 | Velocity Heatmap | P0 | High | 1 |
| VIZ-003 | Team Radar Chart | P1 | High | 2 |
| VIZ-004 | Developer Efficiency Table | P0 | Medium | 1 |
| VIZ-005 | Date Range Picker | P1 | Low | 2 |
| VIZ-006 | Loading States | P1 | Low | 2 |
| VIZ-007 | Error Handling | P1 | Low | 2 |

---

## Service A: cursor-sim Features (v2.0)

### SIM-R001: Seed Loading & Validation

**Priority**: P0 (Critical)
**Complexity**: Medium
**Phase**: 1

This feature loads and validates seed.json generated by DataDesigner, providing the foundation for all event generation.

**Scope:**
The feature parses the seed.json file containing developers, repositories, correlations, and text templates. Validation ensures all required fields are present and values are within acceptable ranges.

**Technical Requirements:**
- Parse seed.json using Go's encoding/json
- Validate developer user_ids match `user_xxx` format
- Validate acceptance_rates are between 0.0 and 1.0
- Validate repository primary_language is supported
- Validate correlations have required keys
- Return detailed error messages for validation failures

**Seed Schema:**
```json
{
  "developers": [{
    "user_id": "user_001",
    "email": "dev@example.com",
    "name": "Jane Developer",
    "org": "Acme Corp",
    "division": "Engineering",
    "team": "Platform",
    "seniority": "senior",
    "region": "us-west",
    "acceptance_rate": 0.85,
    "pr_behavior": {
      "prs_per_week": 2.5,
      "avg_pr_size_loc": 150,
      "greenfield_ratio": 0.3
    }
  }],
  "repositories": [{
    "repo_name": "acme/platform",
    "primary_language": "go",
    "age_days": 730,
    "maturity": "mature",
    "teams": ["Platform", "API"]
  }],
  "correlations": {
    "seniority_acceptance_rate": {...},
    "ai_ratio_revert_rate": {...}
  },
  "text_templates": {
    "commit_messages": [...],
    "pr_titles": [...],
    "review_comments": [...]
  }
}
```

**Dependencies:** None

**Acceptance Criteria:**
- Valid seed.json loads successfully with all data accessible
- Invalid seed.json produces descriptive error with line number
- Missing required fields are detected and reported
- Out-of-range values are detected and reported

---

### SIM-R002: CLI Configuration v2

**Priority**: P0 (Critical)
**Complexity**: Low
**Phase**: 1

This feature implements the v2 CLI flags for operation mode, seed file, and generation parameters.

**Scope:**
The CLI accepts flags for mode (runtime/replay), seed file path, corpus file path, port, and simulation duration.

**Technical Requirements:**
```
cursor-sim [flags]

Flags:
  --mode string        Operation mode: runtime or replay (default "runtime")
  --seed string        Path to seed.json file (required for runtime mode)
  --corpus string      Path to events.parquet (required for replay mode)
  --port int           HTTP server port (default 8080)
  --days int           Days of history to generate (default 90)
  --velocity string    Event generation rate: low, medium, high (default "medium")
  --help               Display help
```

**Dependencies:** None

**Acceptance Criteria:**
- `--mode=runtime` requires `--seed` flag
- `--mode=replay` requires `--corpus` flag
- Invalid mode values produce clear error
- `--help` shows all flags with descriptions
- Environment variables can override flags (CURSOR_SIM_MODE, etc.)

---

### SIM-R003: Commit Generation Engine

**Priority**: P0 (Critical)
**Complexity**: High
**Phase**: 1

This feature generates commits with AI attribution matching the Cursor API schema.

**Scope:**
Generate commits for each developer based on their pr_behavior settings. Each commit includes TAB and COMPOSER line attributions, proper timestamps, and references to PRs (in Phase 2).

**Technical Requirements:**
- Generate commits following Poisson distribution timing
- Split AI lines between TAB (60-80%) and COMPOSER (20-40%)
- Calculate nonAiLinesAdded as max(0, total - tab - composer)
- Generate realistic commit messages from templates
- Assign commits to developers weighted by prs_per_week
- Distribute commits across repositories by team assignment

**Commit Schema (Cursor API match):**
```go
type Commit struct {
    CommitHash        string    `json:"commitHash"`
    UserID            string    `json:"userId"`
    UserEmail         string    `json:"userEmail"`
    UserName          string    `json:"userName"`
    RepoName          string    `json:"repoName"`
    BranchName        string    `json:"branchName"`
    IsPrimaryBranch   bool      `json:"isPrimaryBranch"`
    TotalLinesAdded   int       `json:"totalLinesAdded"`
    TotalLinesDeleted int       `json:"totalLinesDeleted"`
    TabLinesAdded     int       `json:"tabLinesAdded"`
    TabLinesDeleted   int       `json:"tabLinesDeleted"`
    ComposerLinesAdded int      `json:"composerLinesAdded"`
    ComposerLinesDeleted int    `json:"composerLinesDeleted"`
    NonAILinesAdded   int       `json:"nonAiLinesAdded"`
    NonAILinesDeleted int       `json:"nonAiLinesDeleted"`
    Message           string    `json:"message"`
    CommitTs          time.Time `json:"commitTs"`
    CreatedAt         time.Time `json:"createdAt"`
}
```

**Dependencies:** SIM-R001, SIM-R002

**Acceptance Criteria:**
- Commits generated continuously at configured velocity
- AI attribution lines sum correctly: total = tab + composer + nonAi
- Commit distribution matches developer pr_behavior weights
- Same seed produces reproducible commit sequences

---

### SIM-R004: Cursor Admin API

**Priority**: P0 (Critical)
**Complexity**: Medium
**Phase**: 1

This feature implements the 4 Cursor Admin API endpoints.

**Endpoints:**
```
GET  /teams/members
POST /teams/daily-usage-data
POST /teams/filtered-usage-events
POST /teams/spend
```

**Technical Requirements:**
- Basic Auth matching Cursor API (API key as username, empty password)
- Pagination with page/pageSize (max 500)
- Date filtering with startDate/endDate
- JSON response format matching Cursor exactly

**Response Format:**
```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "pageSize": 100,
    "totalUsers": 50,
    "totalPages": 1,
    "hasNextPage": false,
    "hasPreviousPage": false
  },
  "params": {
    "teamId": 12345
  }
}
```

**Dependencies:** SIM-R001, SIM-R008

**Acceptance Criteria:**
- All 4 endpoints respond with correct schema
- Auth returns 401 for missing/invalid credentials
- Pagination works correctly
- Date filtering bounds results

---

### SIM-R005: Cursor AI Code Tracking API

**Priority**: P0 (Critical)
**Complexity**: Medium
**Phase**: 1

This feature implements the 4 AI Code Tracking endpoints including CSV exports.

**Endpoints:**
```
GET /analytics/ai-code/commits
GET /analytics/ai-code/commits.csv
GET /analytics/ai-code/changes
GET /analytics/ai-code/changes.csv
```

**Technical Requirements:**
- Cursor pagination style with page/pageSize
- startDate/endDate filtering
- users filter (comma-separated emails or user IDs)
- CSV endpoints return RFC 4180 compliant output
- JSON response matches Cursor exactly

**Dependencies:** SIM-R003, SIM-R008

**Acceptance Criteria:**
- JSON endpoints return proper Cursor response format
- CSV endpoints produce valid CSV with headers
- Date filtering works correctly
- User filtering supports both email and user_id

---

### SIM-R006: Cursor Team Analytics API

**Priority**: P0 (Critical)
**Complexity**: High
**Phase**: 1

This feature implements all 11 team-level analytics endpoints.

**Endpoints:**
```
GET /analytics/team/agent-edits
GET /analytics/team/tabs
GET /analytics/team/dau
GET /analytics/team/client-versions
GET /analytics/team/models
GET /analytics/team/top-file-extensions
GET /analytics/team/mcp
GET /analytics/team/commands
GET /analytics/team/plans
GET /analytics/team/ask-mode
GET /analytics/team/leaderboard
```

**Technical Requirements:**
- All endpoints support startDate/endDate/users query params
- Response aggregates by event_date
- Leaderboard supports page/pageSize pagination
- Rate limiting: 100 requests/minute

**Response Schemas:**
Each endpoint has a specific schema. See Cursor documentation for exact field names.

**Dependencies:** SIM-R003, SIM-R008

**Acceptance Criteria:**
- All 11 endpoints respond with correct schema
- Aggregations are accurate by date
- Leaderboard ranks correctly by acceptance ratio
- Rate limiting returns 429 when exceeded

---

### SIM-R007: Cursor By-User Analytics API

**Priority**: P0 (Critical)
**Complexity**: Medium
**Phase**: 1

This feature implements all 9 by-user analytics endpoints.

**Endpoints:**
```
GET /analytics/by-user/agent-edits
GET /analytics/by-user/tabs
GET /analytics/by-user/models
GET /analytics/by-user/top-file-extensions
GET /analytics/by-user/client-versions
GET /analytics/by-user/mcp
GET /analytics/by-user/commands
GET /analytics/by-user/plans
GET /analytics/by-user/ask-mode
```

**Technical Requirements:**
- Pagination with page/pageSize (max 500)
- Response grouped by user_email
- userMappings in params section
- Rate limiting: 50 requests/minute

**Response Format:**
```json
{
  "data": {
    "user@example.com": [
      { "event_date": "2026-01-15", ... }
    ]
  },
  "pagination": {...},
  "params": {
    "metric": "tabs",
    "userMappings": [
      { "id": "user_001", "email": "user@example.com" }
    ]
  }
}
```

**Dependencies:** SIM-R003, SIM-R008

**Acceptance Criteria:**
- All 9 endpoints respond with correct schema
- Data correctly grouped by user
- Pagination across users works correctly
- Rate limiting returns 429 when exceeded

---

### SIM-R008: In-Memory Storage v2

**Priority**: P0 (Critical)
**Complexity**: Medium
**Phase**: 1

This feature implements thread-safe in-memory storage for v2 data models.

**Scope:**
Store developers (from seed), commits, and (in Phase 2) PRs and reviews. Support efficient queries by time range, user, and repository.

**Technical Requirements:**
- Thread-safe using sync.RWMutex or sync.Map
- Time-indexed commits for efficient range queries
- User-indexed data for by-user endpoints
- Repository-indexed for GitHub API
- Memory-efficient for 100k+ commits

**Interface:**
```go
type Store interface {
    // Developers
    LoadDevelopers([]Developer) error
    GetDeveloper(userID string) (*Developer, error)
    ListDevelopers() []Developer

    // Commits
    AddCommit(Commit) error
    GetCommitsByTimeRange(from, to time.Time) []Commit
    GetCommitsByUser(userID string, from, to time.Time) []Commit
    GetCommitsByRepo(repoName string, from, to time.Time) []Commit

    // PRs (Phase 2)
    AddPullRequest(PullRequest) error
    GetPullRequest(repoName string, number int) (*PullRequest, error)
    // ...
}
```

**Dependencies:** SIM-R001

**Acceptance Criteria:**
- Concurrent read/write is safe
- Time range queries return correct results
- Memory usage < 500MB for 100k commits
- Query performance < 10ms for typical queries

---

### SIM-R009: PR Generation Pipeline

**Priority**: P1 (Important)
**Complexity**: High
**Phase**: 2

This feature generates pull requests with full lifecycle and correlation enforcement.

**Scope:**
Generate PRs with realistic attributes including size, scatter, timeline, and review metrics. Enforce correlations between seniority/AI ratio and outcomes.

**Technical Requirements:**
- Select authors weighted by prs_per_week
- Generate 1-8 commits per PR
- Calculate timeline: coding â†’ PR open â†’ review â†’ merge
- Apply correlation coefficients from seed
- Generate PR attributes: additions, deletions, changed_files
- Track initial vs final additions for scope_creep

**PR Lifecycle:**
```
first_commit_at
    â”‚ coding_lead_time
    â–¼
created_at (PR opened)
    â”‚ pickup_time
    â–¼
first_review_at
    â”‚ review iterations
    â–¼
merged_at (or closed)
```

**Dependencies:** SIM-R003, SIM-R008

**Acceptance Criteria:**
- PRs have realistic size distribution (lognormal)
- Timelines respect business hours by region
- Correlations are enforced within configured tolerance
- Same seed produces reproducible PRs

---

### SIM-R010: Review Simulation

**Priority**: P1 (Important)
**Complexity**: High
**Phase**: 2

This feature simulates code review iterations with comments and approvals.

**Scope:**
Generate review events including CHANGES_REQUESTED, APPROVED, and comments. Model iteration cycles where high AI ratio leads to more iterations.

**Technical Requirements:**
- Generate 1-5 reviewers per PR
- Generate review comments proportional to PR size
- Model iteration: review â†’ rework commits â†’ re-review
- Apply ai_ratio â†’ iterations correlation
- Generate realistic review comment text from templates

**Review States:**
```
PENDING â†’ CHANGES_REQUESTED â†’ APPROVED
              â†“ (rework)        â†‘
         new commits â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Dependencies:** SIM-R009, SIM-R008

**Acceptance Criteria:**
- Reviews correctly cycle through states
- Iteration count correlates with AI ratio
- Review density (comments/LoC) is realistic
- Same seed produces reproducible reviews

---

### SIM-R011: GitHub Repos/PRs API

**Priority**: P1 (Important)
**Complexity**: High
**Phase**: 2

This feature implements GitHub-style REST endpoints for repositories and pull requests.

**Endpoints:**
```
GET /repos
GET /repos/{owner}/{repo}
GET /repos/{owner}/{repo}/pulls
GET /repos/{owner}/{repo}/pulls/{n}
GET /repos/{owner}/{repo}/pulls/{n}/commits
GET /repos/{owner}/{repo}/pulls/{n}/files
GET /repos/{owner}/{repo}/pulls/{n}/reviews
GET /repos/{owner}/{repo}/commits
GET /repos/{owner}/{repo}/commits/{sha}
```

**Technical Requirements:**
- GitHub-style pagination with Link headers
- Response schemas match GitHub API v3
- Support state filter (open, closed, merged, all)
- Support sort/direction params

**Dependencies:** SIM-R009, SIM-R010

**Acceptance Criteria:**
- All endpoints return GitHub-compatible responses
- Pagination with Link headers works correctly
- Filters correctly limit results
- Same PR data accessible via Cursor and GitHub APIs

---

### SIM-R012: Quality Outcomes

**Priority**: P1 (Important)
**Complexity**: Medium
**Phase**: 2

This feature determines quality outcomes (reverts, hotfixes) based on correlations.

**Scope:**
Mark PRs as reverted or having hotfix follow-ups based on ai_ratio and seniority correlations. Generate revert/hotfix PRs.

**Technical Requirements:**
- Revert within 7 days based on ai_ratio_revert_rate correlation
- Hotfix PRs within 48 hours for urgent fixes
- Connect revert PRs to original via reference
- Track survival state for code survival analysis

**Outcome Logic:**
```
if rand() < ai_ratio_revert_rate[ai_bucket]:
    mark PR as reverted
    generate revert PR within 7 days

if rand() < hotfix_rate[severity]:
    generate hotfix PR within 48 hours
```

**Dependencies:** SIM-R009, SIM-R008

**Acceptance Criteria:**
- Revert rate matches configured correlations
- Revert PRs reference original PR
- Hotfix timing is realistic (< 48h)
- Outcomes reproducible with same seed

---

### SIM-R013: Research Dataset Export

**Priority**: P2 (Nice to Have)
**Complexity**: Medium
**Phase**: 3

This feature provides pre-joined research datasets via API.

**Endpoints:**
```
GET /research/dataset?format=json|csv|parquet
GET /research/metrics/velocity
GET /research/metrics/review-costs
GET /research/metrics/quality
```

**Technical Requirements:**
- Join Cursor and GitHub data on shared keys
- Export as JSON, CSV, or Parquet
- Include all research variables per row
- Support filtering by date range

**Research Dataset Columns:**
```
pr_number, author_email, repo_name,
ai_lines_added, ai_ratio, pr_volume, greenfield_index,
coding_lead_time_hours, pickup_time_hours, review_lead_time_hours,
review_density, iterations, rework_ratio, scope_creep,
is_reverted, survival_rate_30d, has_hotfix_followup,
author_seniority, repo_age_days, primary_language
```

**Dependencies:** SIM-R009, SIM-R012

**Acceptance Criteria:**
- All formats produce valid output
- JOIN keys align correctly
- Research variables calculated accurately
- Export performance > 10MB/s

---

### SIM-R014: Code Survival Tracking

**Priority**: P2 (Nice to Have)
**Complexity**: High
**Phase**: 3

This feature tracks what percentage of code survives over time.

**Scope:**
Calculate code survival rates at 7, 14, and 30 days. Track which commits are modified or removed by subsequent commits.

**Technical Requirements:**
- Track line-level changes across commits
- Calculate survival as: (lines_remaining / lines_added) at t+N days
- Store survival snapshots for efficiency
- Support per-file and per-PR survival

**Dependencies:** SIM-R003, SIM-R009

**Acceptance Criteria:**
- Survival rates calculated correctly
- Performance acceptable for 100k commits
- Survival correlates with AI ratio (configurable)

---

### SIM-R015: Replay Mode

**Priority**: P2 (Nice to Have)
**Complexity**: Medium
**Phase**: 3

This feature serves pre-generated events from a Parquet file.

**Scope:**
Load events from Parquet corpus and serve via the same APIs. No generation logic, just read-only serving for reproducible research.

**Technical Requirements:**
- Load Parquet using parquet-go library
- Index data for efficient queries
- Same API responses as runtime mode
- Fast startup (< 1s for 1M events)

**Usage:**
```bash
cursor-sim --mode=replay --corpus=research_corpus.parquet --port=8080
```

**Dependencies:** SIM-R008

**Acceptance Criteria:**
- Parquet files load correctly
- APIs return identical results to runtime mode
- Startup time < 1s for typical corpus
- Read-only (no writes accepted)

---

## Phase Summary

### Phase 1: Complete Cursor API (MVP)

**Goal:** Working cursor-sim that exactly matches Cursor Business API

**Features:**
- SIM-R001: Seed Loading
- SIM-R002: CLI v2
- SIM-R003: Commit Generation
- SIM-R004: Admin API
- SIM-R005: AI Code Tracking
- SIM-R006: Team Analytics
- SIM-R007: By-User Analytics
- SIM-R008: Storage v2

**Estimated Hours:** 45

**Exit Criteria:**
- All 29 Cursor endpoints implemented
- Response schemas match Cursor docs
- Test coverage > 80%

### Phase 2: PR Lifecycle + GitHub API

**Goal:** Full SDLC simulation with PR lifecycle

**Features:**
- SIM-R009: PR Generation
- SIM-R010: Review Simulation
- SIM-R011: GitHub API
- SIM-R012: Quality Outcomes

**Estimated Hours:** 28

**Exit Criteria:**
- All 12 GitHub endpoints implemented
- Correlations enforced correctly
- Revert/hotfix simulation working

### Phase 3: Research Framework

**Goal:** Research-ready dataset export

**Features:**
- SIM-R013: Research Dataset
- SIM-R014: Code Survival
- SIM-R015: Replay Mode

**Estimated Hours:** 18

**Exit Criteria:**
- Pre-joined dataset export working
- Parquet export functional
- Replay mode stable

---

## Deprecation Notice: v1.0 Features

The following v1.0 features are replaced by v2.0 equivalents:

| v1.0 Feature | Status | v2.0 Replacement |
|--------------|--------|------------------|
| SIM-001: Developer Profile Generation | DEPRECATED | SIM-R001: Seed Loading |
| SIM-002: Event Generation Engine | DEPRECATED | SIM-R003: Commit Generation |
| SIM-003: REST API Server | DEPRECATED | SIM-R004 through SIM-R007 |
| SIM-004: CLI Configuration | DEPRECATED | SIM-R002: CLI v2 |
| SIM-005: Team Structure Simulation | DEPRECATED | Loaded from seed |
| SIM-006: Realistic Time Patterns | RETAINED | Integrated into SIM-R003 |
